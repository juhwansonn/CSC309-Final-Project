datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                  Int           @id @default(autoincrement())
  utorid              String        @unique
  name                String
  email               String        @unique
  password            String?
  role                String
  points              Int           @default(0)
  createdAt           DateTime      @default(now())
  lastLogin           DateTime?
  verified            Boolean       @default(false)
  suspicious          Boolean       @default(false)
  birthday            DateTime?
  avatarFilename      String?
  resetToken          String?
  resetExpires        DateTime?
  // Relationships
  transactions        Transaction[] @relation("UserTransactions")
  createdTransactions Transaction[] @relation("CreatedTransactions")
  organizedEvents     Event[]       @relation("EventOrganizers")
  guestEvents         Event[]       @relation("EventGuests")
}

model Transaction {
  id          Int         @id @default(autoincrement())
  type        String
  spent       Float?
  amount      Int
  remark      String?
  suspicious  Boolean     @default(false)
  relatedId   Int?
  redeemed    Int?
  // Relationships
  user        User        @relation("UserTransactions", fields: [userId], references: [id])
  userId      Int
  createdBy   User        @relation("CreatedTransactions", fields: [createdById], references: [id])
  createdById Int
  promotions  Promotion[] @relation("TransactionPromotions")
}

model Promotion {
  id           Int           @id @default(autoincrement())
  name         String
  description  String
  type         String
  startTime    DateTime
  endTime      DateTime
  minSpending  Float?
  rate         Float?
  points       Int           @default(0)
  // Relationships
  transactions Transaction[] @relation("TransactionPromotions")
}

model Event {
  id              Int      @id @default(autoincrement())
  name            String
  description     String
  location        String
  startTime       DateTime
  endTime         DateTime
  capacity        Int?
  points          Int
  pointsRemaining Int
  published       Boolean  @default(false)
  // Relationships
  organizers      User[]   @relation("EventOrganizers")
  guests          User[]   @relation("EventGuests")
}
