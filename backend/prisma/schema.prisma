datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id         Int       @id @default(autoincrement())
  utorid     String    @unique
  email      String    @unique
  name       String
  password   String?
  birthday   DateTime?
  role       RoleType?
  points     Int
  avatarUrl  String?
  suspicious Boolean
  verified   Boolean
  token      String?
  createdAt  DateTime?
  expiresAt  DateTime?
  lastLogin  DateTime?
  organizer  Event[]   @relation("eventOrganizer")
  guest      Event[]   @relation("eventGuest")
  usages     Usage[]
}

model Event {
  id            Int      @id @default(autoincrement())
  name          String
  description   String
  location      String
  startTime     DateTime
  endTime       DateTime
  capacity      Int?
  pointsRemain  Int
  pointsAwarded Int
  published     Boolean
  organizers    User[]   @relation("eventOrganizer")
  guests        User[]   @relation("eventGuest")
}

model Transaction {
  id          Int         @id @default(autoincrement())
  utorid      String
  type        String
  spent       Float       @default(0)
  earned      Int?
  amount      Int         @default(0)
  remark      String?
  createdBy   String
  relatedId   Int?
  eventId     Int?
  processed   Boolean     @default(false)
  processedBy String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  suspicious  Boolean     @default(false)
  promotions  Promotion[]
}

model Promotion {
  id           Int           @id @default(autoincrement())
  name         String
  type         String        @default("automatic")
  startTime    DateTime
  endTime      DateTime
  isOneTime    Boolean       @default(false)
  minSpending  Int?
  rate         Float?
  points       Int?
  usages       Usage[]
  description  String?
  transactions Transaction[]
}

model Usage {
  id          Int       @id @default(autoincrement())
  userId      Int
  user        User      @relation(fields: [userId], references: [id])
  promotionId Int
  promotion   Promotion @relation(fields: [promotionId], references: [id])
}

generator client {
  provider = "prisma-client-js"
}

enum RoleType {
  regular
  cashier
  manager
  superuser
}

enum TransactionType {
  purchase
  redemption
  adjustment
  event
  transfer
}

enum PromotionType {
  automatic
  onetime
}
